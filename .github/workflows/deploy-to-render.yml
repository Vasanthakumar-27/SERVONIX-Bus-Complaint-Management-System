name: Deploy to Render (manual)
on:
  workflow_dispatch:

jobs:
  trigger-render-deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: read

    steps:
      - name: Trigger Render deploy
        run: |
          API_KEY="${{ secrets.RENDER_API_KEY }}"
          SVC_ID="${{ secrets.RENDER_SERVICE_ID }}"
          if [ -n "$API_KEY" ] && [ -n "$SVC_ID" ]; then
            echo "Triggering Render deploy for service $SVC_ID"
            curl -sf -X POST \
              -H "Authorization: Bearer $API_KEY" \
              -H "Accept: application/json" \
              "https://api.render.com/v1/services/$SVC_ID/deploys" \
              -d '{"clearCache":false}'
            echo "Deploy triggered successfully"
          else
            echo "::notice ::RENDER_API_KEY or RENDER_SERVICE_ID not set â€” skipping deploy trigger."
            echo "Render auto-deploys on git push via render.yaml. This step is optional."
          fi
